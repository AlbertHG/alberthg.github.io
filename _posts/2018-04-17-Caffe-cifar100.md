---
layout:     post
title:      Caffe cifar100 å®ä¾‹
subtitle:    "\"ã€Caffe-windowsã€‘ cifar100å®ä¾‹è¿‡ç¨‹è®°å½•\""
date:       2018-04-17
author:     Canary
header-img: img/caffe_cifar10.jpg
catalog: true
tags:
    - caffe
    - cifar
    - python2
    - windows
    - è®°å½•
---

## å‰è¨€

> åœ¨è¿‡å®Œcifar-10çš„ä¾‹ç¨‹ä¹‹åï¼Œç°åœ¨å¯¹cifar-100çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œä½†æ˜¯è¿™ä¸€æ¬¡ä¸ä¸‹è½½æ•°æ®é›†çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œæ‰“ç®—è¯•ç”¨ä¸‹caffe-pythonæ¥å£ã€‚ç°å¯¹æ­¤åœ¨ Windows Caffe ä¸‹çš„æ“ä½œåšç®€è¦è®°å½•ï¼

## cifar-100æ•°æ®é›†è·å–

cifar-10æ•°æ®é›†å’Œcifar-100æ•°æ®é›†çš„å®˜æ–¹ç½‘å€éƒ½æ˜¯ï¼š[https://www.cs.toronto.edu/~kriz/cifar.html](https://www.cs.toronto.edu/~kriz/cifar.html)

è¿™ä¸ªæ•°æ®é›†å°±åƒCIFAR-10ï¼Œé™¤äº†å®ƒæœ‰100ä¸ªç±»ï¼Œæ¯ä¸ªç±»åŒ…å«600ä¸ªå›¾åƒã€‚ï¼Œæ¯ç±»å„æœ‰500ä¸ªè®­ç»ƒå›¾åƒå’Œ100ä¸ªæµ‹è¯•å›¾åƒã€‚CIFAR-100ä¸­çš„100ä¸ªç±»è¢«åˆ†æˆ20ä¸ªè¶…ç±»ã€‚æ¯ä¸ªå›¾åƒéƒ½å¸¦æœ‰ä¸€ä¸ªâ€œç²¾ç»†â€æ ‡ç­¾ï¼ˆå®ƒæ‰€å±çš„ç±»ï¼‰å’Œä¸€ä¸ªâ€œç²—ç³™â€æ ‡ç­¾ï¼ˆå®ƒæ‰€å±çš„è¶…ç±»ï¼‰ï¼Œæ¯”å¦‚è¶…ç±»â€œé±¼â€é‡Œè¾¹åˆç»†åˆ†ä¸ºâ€œæ°´æ—é¦†çš„é±¼ï¼Œæ¯”ç›®é±¼ï¼Œå°„çº¿ï¼Œé²¨é±¼ï¼Œé³Ÿé±¼â€ ç­‰å°ç±»ã€‚

cifar-100æœ‰ä¸‰ç§ç‰ˆæœ¬ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯ç¬¬ä¸‰ä¸ª `CIFAR-100 python version`

```
CIFAR-100 python version    161 MB  eb9058c3a382ffc7106e4002c42a8d85
CIFAR-100 Matlab version    175 MB  6a4bfa1dcd5c9453dda6bb54194911f4
CIFAR-100 binary version (suitable for C programs)  161 MB  03b5dce01913d631647c71ecec9e9cb8
```

å°†ä¸‹è½½å¥½çš„å‹ç¼©åŒ…å‹ç¼©åˆ°è·¯å¾„ `D:\GitHub Repository\caffe\data\cifar100`ã€‚

![](https://raw.githubusercontent.com/AlbertHG/alberthg.github.io/master/makedown_img/20180417caffecifar100/1.jpg)

åœ¨å®˜ç½‘ä¸Šæ³¨æ˜äº†ä»¥ä¸‹ä¸€å°æ®µä»£ç ï¼š

```python
def unpickle(file):
    import cPickle
    fo = open(file, 'rb')
    dict = cPickle.load(fo)
    fo.close()
    return dict
```

é€šè¿‡ä»¥ä¸Šä»£ç å¯ä»¥å°†å…¶è½¬æ¢æˆä¸€ä¸ªdictå¯¹è±¡ï¼Œtestå’Œtrainçš„dictä¸­åŒ…å«ä»¥ä¸‹å…ƒç´ ï¼š

- `data`ï¼šä¸€ä¸ª`n*3072`çš„numpyæ•°ç»„,æ¯ä¸€è¡Œéƒ½æ˜¯(32,32,3)çš„RGBå›¾åƒ,`n`ä»£è¡¨å›¾åƒä¸ªæ•°ã€‚

- `coarse_labels`ï¼šä¸€ä¸ªèŒƒå›´åœ¨0-19çš„åŒ…å«`n`ä¸ªå…ƒç´ çš„åˆ—è¡¨,å¯¹åº”å›¾åƒçš„å¤§ç±»åˆ«ã€‚

- `fine_labels`ï¼šä¸€ä¸ªèŒƒå›´åœ¨0-99çš„åŒ…å«`n`ä¸ªå…ƒç´ çš„åˆ—è¡¨,å¯¹åº”å›¾åƒçš„å°ç±»åˆ«ã€‚

- è€Œ`meta`çš„`dict`ä¸­åªåŒ…å«`fine_label_names`,ç¬¬`i`ä¸ªå…ƒç´ å¯¹åº”å…¶çœŸæ­£çš„ç±»åˆ«ã€‚


äºæ˜¯ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ–°å»º `convert_dict.py` å®ç°æ•°æ®è½¬æ¢ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```python
# -*- coding: UTF-8 -*-
import os
import cPickle

import numpy as np
import sklearn
import sklearn.cross_validation
import sklearn.linear_model

import lmdb
import caffe


def unpickle(file):
    """ unpickle the data """
    fo = open(file, 'rb')
    dict = cPickle.load(fo)
    fo.close()
    return dict


def shuffle_data(data, labels):
    data, _, labels, _ = sklearn.cross_validation.train_test_split(
        data, labels, test_size=0.0, random_state=42
    )
    return data, labels


def load_data(train_file):
    """  load the train and test data"""
    d = unpickle(train_file)
    data = d['data']
    # coarse_labels = d['coarse_labels']
    fine_labels = d['fine_labels']
    length = len(d['fine_labels'])

    data, labels = shuffle_data(
        data,
        # np.array(zip(coarse_labels, fine_labels))
        np.array(fine_labels)
    )
    # coarse_labels, fine_labels = zip(*labels.tolist())
    return (
        data.reshape(length, 3, 32, 32),
        # np.array(coarse_labels),
        labels
    )


if __name__ == '__main__':
    cifar_python_directory = os.path.abspath("cifar-100-python")

    # meta=unpickle(os.path.join(cifar_python_directory, 'meta'))
    # fine_label_names=meta['fine_label_names']
    # print(fine_label_names)

    print("Converting...")
    cifar_caffe_directory = os.path.abspath("cifar100_train_lmdb")
    if not os.path.exists(cifar_caffe_directory):

        X, y_f = load_data(os.path.join(cifar_python_directory, 'train'))
        Xt, yt_f = load_data(os.path.join(cifar_python_directory, 'test'))

        print("Data is fully loaded,now truly convertung.")

        env = lmdb.open(cifar_caffe_directory, map_size=50000 * 1000 * 5)
        txn = env.begin(write=True)
        count = 0
        for i in range(X.shape[0]):
            datum = caffe.io.array_to_datum(X[i], y_f[i])
            str_id = '{:08}'.format(count)
            txn.put(str_id, datum.SerializeToString())

            count += 1
            if count % 1000 == 0:
                print('already handled with {} pictures'.format(count))
                txn.commit()
                txn = env.begin(write=True)

        txn.commit()
        env.close()

        env = lmdb.open('cifar100_test_lmdb', map_size=10000 * 1000 * 5)
        txn = env.begin(write=True)
        count = 0
        for i in range(Xt.shape[0]):
            datum = caffe.io.array_to_datum(Xt[i], yt_f[i])
            str_id = '{:08}'.format(count)
            txn.put(str_id, datum.SerializeToString())

            count += 1
            if count % 1000 == 0:
                print('already handled with {} pictures'.format(count))
                txn.commit()
                txn = env.begin(write=True)

        txn.commit()
        env.close()
    else:
        print("Conversion was already done. Did not convert twice.")
```

åœ¨å½“å‰ç›®å½•å‘½ä»¤è¡Œæ‰§è¡Œè¯¥æ–‡ä»¶ï¼š

```
python .\convert_dict.py
```

è¿™ä¸ªæ—¶å€™ï¼Œç³Ÿå¿ƒçš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œå‡ºç°æŠ¥é”™ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªï¼Œé‚£å¥½å§ï¼Œä¸€ä¸ªä¸ªè§£å†³å‘—ï¼ï¼

1. æŠ¥é”™`Non-ASCII character 'xe5' in file`ï¼š

    Pythoné»˜è®¤æ˜¯ä»¥ASCIIä½œä¸ºç¼–ç æ–¹å¼çš„ï¼Œå¦‚æœåœ¨è‡ªå·±çš„Pythonæºç ä¸­åŒ…å«äº†ä¸­æ–‡ï¼ˆæˆ–è€…å…¶ä»–éè‹±è¯­ç³»çš„è¯­è¨€ï¼‰ï¼Œæ­¤æ—¶å³ä½¿ä½ æŠŠè‡ªå·±ç¼–å†™çš„Pythonæºæ–‡ä»¶ä»¥UTF-8æ ¼å¼ä¿å­˜äº†ï¼Œä½†å®é™…ä¸Šï¼Œè¿™ä¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œåªè¦åœ¨æ–‡ä»¶å¼€å¤´åŠ å…¥ä¸‹é¢ä»£ç å°±è¡Œäº†ã€‚

    ```python
    # -*- coding: UTF-8 -*-  
    ```

1. æç¤ºæ‰¾ä¸åˆ°`ImportError: No module named 'cPickle'`

    ```python
    Traceback (most recent call last):
      File ".\convert_dict.py", line 2, in <module>
        import cPickle
    ImportError: No module named 'cPickle'
    ```
    python3ç‰ˆæœ¬æ²¡æœ‰cPickleäº†ï¼Œæ”¹æˆ`import pickle`å³å¯ã€‚

1. æŠ¥é”™æç¤ºæ‰¾ä¸åˆ°æ¨¡å—`sklearn`ï¼š

    ```python
    ImportError: No module named sklearn
    ```
    ä½¿ç”¨anacondaåœ¨æŒ‡å®šçš„pythonç¯å¢ƒä¸‹å®‰è£…åŒ…`scikit-learn`ã€‚

1. æŠ¥é”™æç¤ºæ‰¾ä¸åˆ°æ¨¡å—`lmdb`ï¼š

    ```python
    ImportError: No module named lmdb
    ```
    ä½¿ç”¨anacondaåœ¨æŒ‡å®šçš„pythonç¯å¢ƒä¸‹å®‰è£…åŒ…`python-lmdb`ã€‚

1. æŠ¥é”™`UnicodeDecodeError: 'ascii' codec can't decode byte 0xff in position 0: ordinal not in range(128)`ï¼š

    ```python
    Traceback (most recent call last):
      File ".\convert_dict.py", line 60, in <module>
        X, y_f = load_data(os.path.join(cifar_python_directory, 'train'))
      File ".\convert_dict.py", line 30, in load_data
        d = unpickle(train_file)
      File ".\convert_dict.py", line 16, in unpickle
        dict = cPickle.load(fo)
    UnicodeDecodeError: 'ascii' codec can't decode byte 0xff in position 0: ordinal not in range(128)
    ```
    ä¿®æ”¹è¯­å¥`dict = cPickle.load(fo)`æ”¹æˆ`dict = cPickle.load(fo, encoding='latin1')`

1. å‡ºç°`RuntimeError: module compiled against API version 0xc but this version of numpy is 0xb`æŠ¥é”™ï¼š

    ```python
    RuntimeError: module compiled against API version 0xc but this version of numpy is 0xb
    Traceback (most recent call last):
      File ".\convert_dict.py", line 10, in <module>
        import caffe
      File "D:\GitHub Repository\caffe-windows\python\caffe\__init__.py", line 1, in <module>
        from .pycaffe import Net, SGDSolver, NesterovSolver, AdaGradSolver, RMSPropSolver, AdaDeltaSolver, AdamSolver, NCCL, Timer
      File "D:\GitHub Repository\caffe-windows\python\caffe\pycaffe.py", line 13, in <module>
        from ._caffe import Net, SGDSolver, NesterovSolver, AdaGradSolver, \
    ImportError: numpy.core.multiarray failed to import
    ```

    è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œ`numpy`çš„ç‰ˆæœ¬å¤ªä½ï¼Œå°†`numpy`çš„ç‰ˆæœ¬æ›´æ–°åˆ°æœ€æ–°ç‰ˆã€‚

1. æ‰¾ä¸åˆ°ç­”æ¡ˆçš„æŠ¥é”™ï¼š

    ```python
    Traceback (most recent call last):
      File ".\convert_dict.py", line 69, in <module>
        datum = caffe.io.array_to_datum(X[i], y_f[i])
      File "D:\GitHub Repository\caffe\python\caffe\io.py", line 80, in array_to_datum
        datum.label = label
      File "C:\ProgramData\Anaconda3\envs\Caffe_3_5\lib\site-packages\google\protobuf\internal\python_message.py", line 674, in field_setter
        new_value = type_checker.CheckValue(new_value)
      File "C:\ProgramData\Anaconda3\envs\Caffe_3_5\lib\site-packages\google\protobuf\internal\type_checkers.py", line 132, in CheckValue
        raise TypeError(message)
    TypeError: 63 has type <class 'numpy.int32'>, but expected one of: (<class 'int'>,)
    ```

    è¿™æ˜¯ä¸€ä¸ªç³Ÿå¿ƒçš„æŠ¥é”™ï¼Œæ²¡æœ‰è§£å†³æ–¹æ³•ï¼Œå¿ƒç°æ„å†·ingã€‚

ä¸æƒ³å°±æ­¤æ”¾å¼ƒï¼Œè¿™ä¸ªæ—¶å€™æƒ³åˆ°ä¹‹å‰çœ‹è¿‡çš„ä¸€å¥è¯ï¼šâ€œcaffeåœ¨python3ä¸‹çš„å…¼å®¹æ€§æ²¡æœ‰python2å¥½â€ï¼ï¼ï¼ï¼ä¼šä¸ä¼šæ˜¯python3ç¯å¢ƒçš„é—®é¢˜ã€‚å¸¦ç€è¿™ä¸ªç–‘é—®å’Œå¯¹caffe pythonçš„æ€¨å¿µã€‚æˆ‘æ‰“ç®—é‡æ–°ç¼–è¯‘ä¸€épython2ç‰ˆæœ¬çš„caffeã€‚è¯´å¹²å°±å¹²ï¼ï¼ï¼

æ•´ä¸ªè¿‡ç¨‹å’Œåœ¨python3ä¸‹é…ç½®caffeçš„åšå®¢ä¸€æ ·["Caffe for Windows10"](https://alberthg.github.io/2018/04/12/Caffe-Windows-%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/)ã€‚

1. ä¸ºäº†ä¸é€ æˆç¯å¢ƒæ±¡æŸ“ï¼Œæˆ‘ä½¿ç”¨anaconda3æ–°å»ºè™šæ‹Ÿç¯å¢ƒ`Caffe_2_7`ï¼š
    ```
    conda create -n Caffe_2_7 python=2.7.14
    ```

    ç„¶åå°†æ–°åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒæ·»åŠ åˆ°Pathç¯å¢ƒå˜é‡ï¼š

    ```
    C:\ProgramData\Anaconda3\envs\Caffe_2_7
    C:\ProgramData\Anaconda3\envs\Caffe_2_7\Scripts
    ```

    å› ä¸ºæˆ‘åŸæ¥å·²ç»é…ç½®è¿‡python3çš„caffeç‰ˆæœ¬ï¼Œæ‰€ä»¥ç¯å¢ƒå˜é‡é‡Œè¾¹å·²ç»æœ‰python3çš„è·¯å¾„äº†ï¼Œä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ–°å¢çš„python2ï¼Œä¸€å®šè¦å°†ä¸Šè¿°ä¸¤æ¡è·¯å¾„æ”¾åˆ°python3çš„è·¯å¾„çš„å‰è¾¹ï¼š

    ![](https://raw.githubusercontent.com/AlbertHG/alberthg.github.io/master/makedown_img/20180417caffecifar100/2.jpg)

2. åœ¨æ„å»ºcmakeç¼–è¯‘é…ç½®æ–‡ä»¶çš„æ—¶å€™ä¾æ—§ä½¿ç”¨`cmake-gui`å·¥å…·ï¼Œåªéœ€è¦åœ¨å®šä¹‰pythonç‰ˆæœ¬çš„æ—¶å€™å°†pythonçš„æ•°å­—ä¿®æ”¹ä¸º`2`ã€‚

3. ä¸ºäº†èƒ½å¤ŸæˆåŠŸè¿è¡Œpython2ç‰ˆæœ¬çš„`import caffe`ï¼šéœ€è¦å°†æ–°ç¼–è¯‘çš„`caffe/python`æ·»åŠ åˆ°ç¯å¢ƒå˜é‡`PYTHONPATH`,å¹¶ä¿è¯æ–°æ·»åŠ çš„è·¯å¾„åœ¨å…¶ä»–è·¯å¾„çš„å‰è¾¹ã€‚

4. å…¶ä»–æ“ä½œå®Œå…¨ä¸€æ ·ã€‚

5. åŒæ—¶ä¸ºäº†é¿å…æ‰¾ä¸åˆ°ä¸Šè¿°å‡ ä¸ªåŒ…çš„æƒ…å†µï¼Œæˆ‘åœ¨æ–°çš„è™šæ‹Ÿç¯å¢ƒé‡Œï¼Œä½¿ç”¨condaé‡æ–°å®‰è£…äº†`ython-lmdb`ã€`scikit-learn`åŒ…ã€‚è¿™ä¸ªæ—¶å€™é‡æ–°åœ¨Windows PowerShellä¸‹æ‰§è¡Œ`python .\convert_dict.py`:

    ![](https://raw.githubusercontent.com/AlbertHG/alberthg.github.io/master/makedown_img/20180417caffecifar100/3.jpg)

æ¬¢å‘¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ğŸ™Œ

è§‚å¯Ÿè·¯å¾„:

![](https://raw.githubusercontent.com/AlbertHG/alberthg.github.io/master/makedown_img/20180417caffecifar100/4.jpg)

æˆåŠŸè½¬æ¢æˆæˆ‘ä»¬ç†Ÿæ‚‰çš„`cifar100_train_lmdb`å’Œ`cifar100_test_lmdb`äº†ã€‚

## LMDBæ•°æ®æŸ¥çœ‹

æˆ‘ä»¬å°†LMDBæ•°æ®åº“ä¸­æ•°æ®ï¼Œå°†å…¶è½¬åŒ–ä¸ºå¯è§†åŒ–çš„pngæ ¼å¼,æ–°å»º`read_lmdb.py`ä»£ç å¦‚ä¸‹ï¼š

```python
import lmdb
import os
import cv2
import cPickle
import caffe
from caffe.proto import caffe_pb2

def unpickle(file):
    """ unpickle the data """
    fo = open(file, 'rb')
    dict = cPickle.load(fo)
    fo.close()
    return dict

if __name__=='__main__':
    meta=unpickle(os.path.join('cifar-100-python', 'meta'))
    fine_label_names=meta['fine_label_names']

    env=lmdb.open('cifar100_train_lmdb')
    txn=env.begin()
    cursor=txn.cursor()
    datum=caffe_pb2.Datum()

    i=0
    for key,value in cursor:
        datum.ParseFromString(value)
        if i<10:
            data=caffe.io.datum_to_array(datum)
            label=datum.label
            img=data.transpose(1,2,0)
            cv2.imwrite('{}.png'.format(fine_label_names[label]),img)
        i+=1

    env.close()
    print('there are totally {} pictures'.format(i))
```

è¿è¡Œä¸€ä¸‹ä¹‹åï¼Œå½“å‰ç›®å½•ä¸‹å°±ä¼šå‡ºç°è®­ç»ƒé›†ä¸­çš„å‰åå¼ å›¾ç‰‡ã€‚

å¦‚æœå‡ºç°æŠ¥é”™æç¤º`ImportError: No module named cv2`ï¼Œå®‰è£…ä¸€ä¸‹`opencv`åŒ…å³å¯ï¼š

```
conda install -n Caffe_2_7 -c https://conda.binstar.org/menpo opencv
```

## è®¡ç®—å‡å€¼

å¯¹å›¾åƒçš„æ•°æ®é¢„å¤„ç†é€šå¸¸éƒ½æ˜¯é‡‡å–å‡å»åƒç´ å‡å€¼çš„æ–¹å¼ï¼Œcaffe-windowsé€šè¿‡ç¼–è¯‘å¥½çš„`compute_image_mean.exe`ï¼Œæˆ‘çš„åœ¨è·¯å¾„`D:\GitHub Repository\caffe-windows\build\x64\install\bin`ä¸‹ï¼Œå…·ä½“çš„batè„šæœ¬å¯ä»¥å‚è€ƒ[cifar10-caffe-è®¡ç®—å‡å€¼](https://alberthg.github.io/2018/04/14/Caffe-cifar10/#%E8%AE%A1%E7%AE%97%E5%9D%87%E5%80%BC)ï¼Œè¿™é‡Œç»™å‡ºpythonç‰ˆæœ¬çš„ï¼Œæ–°å»ºæ–‡ä»¶`mean.py`:

```python
import caffe
import lmdb
import numpy as np
from caffe.proto import caffe_pb2
import time

lmdb_env=lmdb.open('cifar100_train_lmdb')
lmdb_txn=lmdb_env.begin()
lmdb_cursor=lmdb_txn.cursor()
datum=caffe_pb2.Datum()

N=0
mean = np.zeros((1, 3, 32, 32))
begintime = time.time()
for key,value in lmdb_cursor:
    datum.ParseFromString(value)
    data=caffe.io.datum_to_array(datum)
    image=data.transpose(1,2,0)
    mean[0,0] += image[:, :, 0]
    mean[0,1] += image[:, :, 1]
    mean[0,2] += image[:, :, 2]
    N+=1
    if N % 1000 == 0:
        elapsed = time.time() - begintime
        print("Processed {} images in {:.2f} seconds. "
              "{:.2f} images/second.".format(N, elapsed,
                                             N / elapsed))
mean[0]/=N
blob = caffe.io.array_to_blobproto(mean)
with open('mean.binaryproto', 'wb') as f:
    f.write(blob.SerializeToString())

lmdb_env.close()
```

è¿è¡Œæ–‡ä»¶åœ¨å½“å‰è·¯å¾„ç”Ÿæˆ`mean.binaryproto`æ–‡ä»¶ã€‚

## caffeç½‘ç»œç»“æ„æ–‡ä»¶çš„è®¾ç½®

ä»¿ç…§caffeé‡Œè¾¹å…³äº`cifar10`çš„ç½‘ç»œç»“æ„æ–‡ä»¶åœ¨`cifar100`æ–‡ä»¶å¤¹é‡Œè¾¹æ–°å»º`cifar100_full_solver.prototxt`ï¼š

```text
# The train/test net protocol buffer definition
net: "examples/cifar100/cifar100_full_train_test.prototxt"
# test_iter specifies how many forward passes the test should carry out.
# In the case of CIFAR100, we have test batch size 100 and 500 test iterations,
# covering the full 50,000 testing images.
test_iter: 100
# Carry out testing every 1000 training iterations.
test_interval: 1000
# The base learning rate, momentum and the weight decay of the network.
base_lr: 0.001
momentum: 0.9
weight_decay: 0.004
# The learning rate policy
lr_policy: "fixed"
# Display every 200 iterations
display: 200
# The maximum number of iterations
max_iter: 60000
# snapshot intermediate results
snapshot: 10000
snapshot_format: HDF5
snapshot_prefix: "examples/cifar100/cifar100_full"
# solver mode: CPU or GPU
solver_mode: GPU
```

åŒæ ·åœ¨`cifar100`é‡Œè¾¹æ–°å»º`cifar100_full_train_test.prototxt`:

```text
name: "CIFAR100_full"
layer {
  name: "cifar"
  type: "Data"
  top: "data"
  top: "label"
  include {
    phase: TRAIN
  }
  transform_param {
    mean_file: "data/cifar100/mean.binaryproto"
  }
  data_param {
    source: "data/cifar100/cifar100_train_lmdb"
    batch_size: 100
    backend: LMDB
  }
}
layer {
  name: "cifar"
  type: "Data"
  top: "data"
  top: "label"
  include {
    phase: TEST
  }
  transform_param {
    mean_file: "data/cifar100/mean.binaryproto"
  }
  data_param {
    source: "data/cifar100/cifar100_test_lmdb"
    batch_size: 100
    backend: LMDB
  }
}
layer {
  name: "conv1"
  type: "Convolution"
  bottom: "data"
  top: "conv1"
  param {
    lr_mult: 1
  }
  param {
    lr_mult: 2
  }
  convolution_param {
    num_output: 32
    pad: 2
    kernel_size: 5
    stride: 1
    weight_filler {
      type: "gaussian"
      std: 0.0001
    }
    bias_filler {
      type: "constant"
    }
  }
}

ä»¥ä¸‹å†…å®¹å’Œcaffe/examples/cifar10é‡Œè¾¹çš„`cifar10_quick_train_test.prototxt`é›·åŒï¼Œä¸è¡¨ï¼
```

## å¼€å§‹è®­ç»ƒ cifar-100

æ¥åˆ° Caffe çš„æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶ï¼š `run-train-cifar100.bat`ï¼ŒåŒå‡»è¿è¡Œï¼Œå¼€å§‹è®­ç»ƒæ•°æ®:

```
.\build\x64\install\bin\caffe.exe train --solver=examples/cifar100/cifar100_full_solver.prototxt  
pause  
```

ç»“æŸåï¼Œåœ¨`caffe\examples\cifar100` ç”Ÿæˆçš„caffemodelæ˜¯è®­ç»ƒå®Œæ¯•å¾—åˆ°çš„æ¨¡å‹å‚æ•°æ–‡ä»¶ï¼Œsolverstateæ˜¯è®­ç»ƒä¸­æ–­ä»¥åï¼Œå¯ä»¥ç”¨æ­¤æ–‡ä»¶ä»ä¸­æ–­åœ°æ–¹ç»§ç»­è®­ç»ƒã€‚

æ–°å»ºæ–‡ä»¶ï¼š`run-test-cifar100.bat` åŒå‡»è¿è¡Œæµ‹è¯•ç½‘ç»œçš„æ•ˆæœå’Œè´¨é‡:

```
build\x64\install\bin\caffe.exe test -model=examples\cifar100\cifar100_full_train_test.prototxt -weights=examples\cifar100\cifar100_full_iter_xxxx.caffemodel.h5
pause
```

ä¸Šè¾¹è„šæœ¬çš„`cifar100_quick_iter_xxxx.caffemodel(.h5)`é‡Œè¾¹çš„`xxxx`æ ¹æ®ä½ è‡ªå·±ç”µè„‘ç”Ÿæˆçš„æ¥å†™ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯`cifar100_full_iter_20000.caffemodel.h5`ã€‚

è¦æ³¨æ„æ ¹æ®`solver.prototxt`çš„`snapshot_format`è®¾ç½®ä¸åŒï¼Œå­˜åœ¨ç”Ÿæˆçš„æƒå€¼æ–‡ä»¶åä¸åŒçš„æƒ…å†µï¼Œæœ‰äº›æ˜¯`xxx.caffemodel`æœ‰äº›æ˜¯`xxx.caffemodel.h5`ã€‚

> ç»“æŸï¼ï¼
